<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>EmailJS OTP</title>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    padding: 20px;
}
input, button {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    font-size: 16px;
}
button {
    background: #2c7;
    border: none;
    cursor: pointer;
}
#log {
    margin-top: 10px;
    font-size: 14px;
}
</style>
</head>
<body>

<h2>EmailJS OTP</h2>

<h3>Konfigurasi EmailJS</h3>
<input id="serviceId" placeholder="Service ID">
<input id="templateId" placeholder="Template ID">
<input id="publicKey" placeholder="Public Key">
<button onclick="initEmailJS()">Simpan Konfigurasi</button>

<hr>

<h3>Kirim OTP</h3>
<input id="email" placeholder="Email tujuan">
<button onclick="kirimOTP()">Kirim OTP</button>

<hr>

<h3>Verifikasi OTP</h3>
<input id="otpInput" placeholder="Masukkan OTP">
<button onclick="cekOTP()">Verifikasi</button>

<div id="log"></div>

<script>
let OTP = null;
let emailjsReady = false;

function log(msg) {
    document.getElementById("log").innerText = msg;
}

function initEmailJS() {
    const publicKey = document.getElementById("publicKey").value.trim();
    if (!publicKey) {
        log("Public Key kosong");
        return;
    }
    emailjs.init(publicKey);
    emailjsReady = true;
    log("EmailJS siap");
}

function generateOTP() {
    return Math.floor(100000 + Math.random() * 900000).toString();
}

function kirimOTP() {
    if (!emailjsReady) {
        log("Konfigurasi EmailJS belum disimpan");
        return;
    }

    const serviceId = document.getElementById("serviceId").value.trim();
    const templateId = document.getElementById("templateId").value.trim();
    const email = document.getElementById("email").value.trim();

    if (!serviceId || !templateId || !email) {
        log("Data belum lengkap");
        return;
    }

    OTP = generateOTP();

    const params = {
        to_email: email,
        otp: OTP
    };

    emailjs.send(serviceId, templateId, params)
        .then(() => {
            log("OTP berhasil dikirim");
        })
        .catch(err => {
            log("Gagal kirim OTP: " + err.text);
        });
}

function cekOTP() {
    const input = document.getElementById("otpInput").value.trim();
    if (!OTP) {
        log("OTP belum dikirim");
        return;
    }
    if (input === OTP) {
        log("OTP valid");
        OTP = null;
    } else {
        log("OTP salah");
    }
}
</script>

</body>
</html>
