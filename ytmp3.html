<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Play Video by DexSkieee Ofc</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css2?family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Playwrite DE Grund', sans-serif;
      background-color: #000;
      color: #fff;
    }
    h1 {
      font-family: 'Pixelify Sans', sans-serif;
    }
    .form-control {
      background-color: #333;
      border: 1px solid #555;
      color: #fff;
    }
    .form-control:focus {
      background-color: #555;
      border-color: #777;
      color: #fff;
    }
    .btn-black {
      background-color: #000;
      border: none;
      color: #d9534f;
    }
    .video-container {
      position: relative;
      max-width: 640px;
      margin: auto;
      border: 4px solid #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    .custom-controls {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: rgba(0, 0, 0, 0.7);
      position: absolute;
      bottom: 0;
      width: 100%;
    }
    .custom-controls button {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .volume-slider {
      width: 100px;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center"><i class="fa fa-youtube-play youtube-icon" aria-hidden="true"></i> YT DexSkieee </h1>

    <form id="downloadForm" class="input-group">
      <div class="input-group mb-3">
        <input type="text" class="form-control" id="videoUrl" placeholder="Masukkan Link/Judul Video YouTube" required>
        <div class="input-group-append">
          <button type="submit" class="btn btn-danger">
            <i class="fa fa-search"></i>
          </button>
        </div>
      </div>
    </form>

    <div id="alertContainer" class="mt-3"></div>

    <div id="videoInfo" class="mt-4" style="display: none;">
      <div class="video-container">
        <video id="videoElement" width="100%" controls>
          <source id="videoSource" src="" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        <div class="custom-controls">
          <button class="play-pause"><i class="fa fa-play" id="playPauseIcon"></i></button>
          <button class="backward"><i class="fa fa-fast-backward"></i></button>
          <button class="forward"><i class="fa fa-fast-forward"></i></button>
          <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="1">
          <button class="mute-unmute"><i class="fa fa-volume-up"></i></button>
        </div>
      </div>
      <div id="videoInfoText"></div>
      <button id="downloadBtn" class="btn btn-success mt-2" style="display: none;">Download MP4</button>
    </div>

    <div id="downloadOptions" class="mt-4" style="display: none;"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const video = document.getElementById("videoElement");
    const playPause = document.querySelector(".play-pause");
    const volumeSlider = document.getElementById("volumeSlider");
    const muteUnmute = document.querySelector(".mute-unmute");
    const backward = document.querySelector(".backward");
    const forward = document.querySelector(".forward");
    const downloadBtn = document.getElementById("downloadBtn");

    let isPlaying = false;
    let isMuted = false;

    function extractVideoId(url) {
      try {
        const urlObj = new URL(url);
        if (urlObj.hostname === 'youtu.be') {
          return urlObj.pathname.substring(1); 
        } else if (urlObj.hostname.includes('youtube.com')) {
          return urlObj.searchParams.get("v"); 
        } else {
          return null;
        }
      } catch (error) {
        console.error('Error saat memparsing URL:', error);
        return null;
      }
    }

    document.getElementById('downloadForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      let videoUrl = document.getElementById('videoUrl').value;
      const videoId = extractVideoId(videoUrl);

      if (videoId) {
        videoUrl = `https://www.youtube.com/watch?v=${videoId}`;
      }

      if (!videoUrl) {
        showAlert('Silakan masukkan URL atau judul video.', 'danger');
        return;
      }

      await searchAndPrepareDownload(videoUrl);
    });

    function showAlert(message, type) {
      const alertContainer = document.getElementById('alertContainer');
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type}`;
      alertDiv.innerHTML = message;
      alertContainer.appendChild(alertDiv);
      setTimeout(() => {
        alertDiv.remove();
      }, 3000);
    }

    async function searchAndPrepareDownload(query) {
      try {
        const searchResponse = await axios.get(`https://api.agatz.xyz/api/ytsearch?message=${encodeURIComponent(query)}`);
        const firstVideo = searchResponse.data.data[0];

        if (firstVideo) {
          const videoSource = firstVideo.url;
          const title = firstVideo.title;

          // Set sumber video dan tampilkan informasi video
          document.getElementById("videoSource").src = videoSource; 
          document.getElementById("videoInfoText").innerHTML = title;
          document.getElementById('videoInfo').style.display = 'block';
          document.getElementById('downloadOptions').style.display = 'block';

          // Memuat dan memutar video
          video.load(); 
          video.play(); 
          isPlaying = true;

          // Mendapatkan link download MP4
          axios.get(`https://api.agatz.xyz/api/ytmp4?url=${encodeURIComponent(videoSource)}`, {
            headers: {
              'accept': 'application/json'
            }
          })
          .then(response => {
            const mp4Url = response.data.data.download;
            if (mp4Url) {
              downloadBtn.style.display = 'block'; // Tampilkan tombol download
              downloadBtn.onclick = () => {
                window.open(mp4Url, '_blank'); // Arahkan ke URL download
              };
            } else {
              showAlert('URL download tidak ditemukan.', 'danger');
            }
          })
          .catch(error => {
            console.error('Error saat mengambil URL download:', error);
            showAlert('Terjadi kesalahan saat mendapatkan URL download.', 'danger');
          });
        } else {
          showAlert('Video tidak ditemukan.', 'danger');
        }
      } catch (error) {
        console.error('Error saat mencari video:', error);
        showAlert('Terjadi kesalahan saat mencari video.', 'danger');
      }
    }

    playPause.addEventListener("click", () => {
      if (isPlaying) {
        video.pause();
        playPause.querySelector("i").classList.replace("fa-pause", "fa-play");
      } else {
        video.play();
        playPause.querySelector("i").classList.replace("fa-play", "fa-pause");
      }
      isPlaying = !isPlaying;
    });

    volumeSlider.addEventListener("input", (e) => {
      video.volume = e.target.value;
      if (video.volume === 0) {
        muteUnmute.querySelector("i").classList.replace("fa-volume-up", "fa-volume-off");
        isMuted = true;
      } else {
        muteUnmute.querySelector("i").classList.replace("fa-volume-off", "fa-volume-up");
        isMuted = false;
      }
    });

    muteUnmute.addEventListener("click", () => {
      if (isMuted) {
        video.muted = false;
        volumeSlider.value = volumeSlider.value; // Set volume slider to previous value
        muteUnmute.querySelector("i").classList.replace("fa-volume-off", "fa-volume-up");
      } else {
        video.muted = true;
        volumeSlider.value = 0;
        muteUnmute.querySelector("i").classList.replace("fa-volume-up", "fa-volume-off");
      }
      isMuted = !isMuted;
    });

    backward.addEventListener("click", () => {
      video.currentTime = Math.max(0, video.currentTime - 10);
    });

    forward.addEventListener("click", () => {
      video.currentTime = Math.min(video.duration, video.currentTime + 10);
    });
  </script>
</body>
</html>
